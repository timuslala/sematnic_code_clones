## Polish version of README is further down
## Repository aimed at reproducing two methods for finding cloned code fragments. - Done
## Further goal discovered after data analysis: Fixing the BigCloneBench dataset. This dataset contains many examples not marked as clones, even though they are Type-4 clones.

Currently, the best-performing approach: clustering (KNN) based on embeddings of short code fragment descriptions generated by an LLM.
![](clusterization_results.png)
False positives - examples labeled as clones in the dataset, but clustering and cosine distance suggest otherwise
False negatives - examples labeled as non-clones in the dataset, but clustering and cosine distance suggest otherwise
Dataset size - 540,000 records

# Reproduction
https://drive.google.com/drive/u/1/folders/1DKLOvjTinMGJLjMlA5YTlAaBtNWju8jb
1. Download the repository
2. Restore the Python environment from the pyproject.toml file
###### To skip steps 3-8, which take up a lot of time, use the above Google Drive link to download 'BCB_updated.pkl' and put it in the ./old folder
3. Use Google Drive to download the initial dataset 'id2sourcecode.zip', and label files 'BCB_clone.csv' and 'BCB_nonclone.csv'
4. Unpack the dataset to the ./old/dataset/id2sourcecode folder
5. Put the .csv files in the ./old folder
6. Run ./old/pickle_dataset.py
7. Install LM studio server with the qwen2.5-coder-3b-instruct model
8. Run ./old/updateBCB.pkl.py (WARNING: long processing time)
9. Run clustering_kmeans.py
10. Run cosine_similarity.py
11. Run produce_new_dataset.py

## How the new dataset was created
matching_rows_true_positives.csv - Contains verified clones
matching_rows_true_negatives.csv - Contains verified non-clones
matching_rows_false_positives.csv - Contains code pairs previously marked as clones, but the authors suggest a more accurate label is non-clone
matching_rows_false_negatives.csv - Contains code pairs previously marked as non-clones, but the authors suggest a more accurate label is clone


## Repo, którego celem była reprodukcja 2 sposobów znajdywania sklonowanych części kodu. - Zrobione
## Dalszy cel, który został odkryty po analizie danych. Naprawa datasetu BigCloneBench. Dataset ten zawiera dużo przykładów nie oznaczonych jako klony, mimo, że są klonami typu 4.

Aktualnie najlepiej działające podejście: grupowanie (KNN) po embeddingach krótkich opisów kawałków kodu wygenerowanych przez LLM.
![](clusterization_results.png)
False positives - przykłady oznaczone w datasecie jako klony, a klasteryzacja i odległość cosinusowa twierdzi inaczej
False negatives - przykłady oznaczone w datasecie jako nie klony, a klasteryzacja i odległość cosinusowa twierdzi inaczej
Rozmiar datasetu - 540 000 rekordów

Types of code clones:
- Type-1 (textual similarity): Code fragments that are identical, except for variations in white space, layout, and
comments.
- Type-2 (lexical similarity): Code fragments that are identical, except for variations in identifier names and lexical
values, in addition to the differences in Type-1 clones.
- Type-3 (syntactic similarity): Code snippets that exhibit
syntactic similarities but at the statement level. Alongside
Type-1 and Type-2 clone differences, these fragments may
have added, modified, or removed statements relative to
one another.
- Type-4 (semantically similarity): Code fragments that are
syntactically dissimilar but implement the same functionality.

# Reprodukcja
https://drive.google.com/drive/u/1/folders/1DKLOvjTinMGJLjMlA5YTlAaBtNWju8jb
1. Pobrać repozytorium
2. Przywrócić środowisko pythonowe z pliku pyproject.toml
###### Aby pominąć kroki 3-8, które zajmują dużo czasu, z powyższego dysku Google pobierz 'BCB_updated.pkl' i wsadź go do folderu ./old
3. Pobrać początkowy dataset 'id2sourcecode.zip', pliki z labelami 'BCB_clone.csv' i 'BCB_nonclone.csv'
4. Wypakować dataset do folderu ./old/dataset/id2sourcecode
5. Wsadzić pliki .csv do folderu ./old
6. Uruchomić ./old/pickle_dataset.py
7. Zainstalować LM studio server z modelem qwen2.5-coder-3b-instruct
8. Uruchomić ./old/updateBCB.pkl.py (UWAGA: długi czas przetwarzania)
9. Uruchomić clustering_kmeans.py
10. Uruchomić cosine_similarity.py
11. Uruchomić produce_new_dataset.py

## Sposób utworzenia nowego datasetu
matching_rows_true_positives.csv - Zawiera zweryfikowane klony
matching_rows_true_negatives.csv - Zawiera zweryfikowane nieklony
matching_rows_false_positives.csv - Zawiera pary kodów, które wcześniej były oznaczone jako klony, a autorzy pracy sugerują, że bardziej dokładną etykietą jest brak klonu
matching_rows_false_negatives.csv - Zawiera pary kodów, które wcześniej były oznaczone jako nieklony, a autorzy pracy sugerują, że bardziej dokładną etykietą jest klon kodu


Typy klonów kodu:
- Typ-1 (podobieństwo tekstowe): Fragmenty kodu, które są identyczne, z wyjątkiem różnic w białych znakach, układzie i komentarzach.
- Typ-2 (podobieństwo leksykalne): Fragmenty kodu, które są identyczne, z wyjątkiem różnic w nazwach identyfikatorów i wartościach leksykalnych, oprócz różnic występujących w klonach typu 1.
- Typ-3 (podobieństwo składniowe): Fragmenty kodu wykazujące podobieństwa składniowe na poziomie instrukcji. Oprócz różnic typowych dla klonów typu 1 i 2, te fragmenty mogą mieć dodane, zmodyfikowane lub usunięte instrukcje względem siebie.
- Typ-4 (podobieństwo semantyczne): Fragmenty kodu, które są składniowo różne, ale realizują tę samą funkcjonalność.

